# 任务
## 描述
从redis 的 publish 消息中获取交易对（如：BTC/USDT）的最新成交价格，定时生成 1min，5min 的 k 线，k 线数据包括高，开，低，收，量，k线生成后存入 mysql，使用 gin 框架提供 api 接口，获取 k 线
## 要求：
1. 交易对列表从 mysql 中获取
2. 最新一根 k 线每 0.5 秒使用 redis 的 publish 发布出去

## 实现：
目前基本功能已经实现。首先查询交易对列表放入交易对列表缓存（每9秒查询一次），engine中有任务会定时查询缓存（9s），engine会通过操作保证交易对在移除或新建后，会创建、删除对应的redis频道监听任务。
每个交易对的k线计算通过PairsEval完成，使用了两个队列，订阅频道后，将收到的数据存入tradeQueue。每分钟将队列中的数据取出并计算1min k线，并将计算出的k线存入数据库以及放入缓存+minQueue（1分钟k线的队列）
当minQueue的长度==5时，触发5mink线计算，之后存入数据库并保存到k线缓存。在启动项目时会启动一个协程，每0.5s从缓存中拿k线并publish

## todo
1. 完善log和注释，目前只写了一小部分

